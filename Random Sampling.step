{"creationTimeStamp":"2023-10-03T12:26:33.058Z","modifiedTimeStamp":"2023-10-03T12:38:42.982Z","createdBy":"jussi.varjus@sas.com","modifiedBy":"jussi.varjus@sas.com","name":"Random Sampling.step","displayName":"Random Sampling.step","localDisplayName":"Random Sampling.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","uri":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","uri":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","uri":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","uri":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","uri":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","uri":"/dataFlows/steps/253082b6-6640-4167-a5c9-24c7a5c8066b","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","localDisplayName":"inputtable1","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"}],"outputPorts":[{"name":"outputtable1","displayName":"outputtable1","localDisplayName":"outputtable1","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","supportsView":false,"requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Settings\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable1\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Input table label 1\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"outputtable1\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output table label 1\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_SAMPLE_PCT\",\n\t\t\t\t\t\"type\": \"numstepper\",\n\t\t\t\t\t\"label\": \"Sample size (%):\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"integer\": false,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"max\": 99,\n\t\t\t\t\t\"stepsize\": 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_STRATA_VAR\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Strata variable:\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"a\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": null,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"table\": \"inputtable1\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_SEED\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Seed value:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"inputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"outputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"_SAMPLE_PCT\": 70,\n\t\t\"_STRATA_VAR\": [],\n\t\t\"_SEED\": \"12345\"\n\t}\n}","templates":{"SAS":"/* SAS templated code goes here */\n\n*%put _all_;\n\n%macro _random_sampling_;\n\n/* If both input and output tables are CAS tables we use proc cas for sampling. */\n%if ((&INPUTTABLE1_ENGINE. eq CAS) and (&OUTPUTTABLE1_ENGINE. eq CAS))\n   %then %do;\n   %put Both datasets are CAS tables.;\n\nproc cas;\n   %if (&_STRATA_VAR_COUNT. ne 0) \n/* Stratified sampling */\n      %then %do;\n      %put Stratified sampling is reqested. ;\n   sampling.stratified /\n      table    = {caslib=\"&INPUTTABLE1_LIB.\" name=\"&INPUTTABLE1_NAME.\", groupby={\"&_STRATA_VAR_1_NAME.\"}} \n      %end; \n/* Simple random sampling  */\n      %else %do;\n      %put Simple random sampling is reqested. ;\n   sampling.srs result=r /\n      table    = {caslib=\"&INPUTTABLE1_LIB.\", name=\"&INPUTTABLE1_NAME.\"}\n      %end; \n\n/* ...otherwise the settings are the same for both sampling methods. */\n      samppct  = &_SAMPLE_PCT. \n      seed     = &_SEED.\n      output   = {casout={caslib=\"&OUTPUTTABLE1_LIB.\", name=\"&OUTPUTTABLE1_NAME.\", replace=\"TRUE\"},\n                  copyvars=\"ALL\"};\nquit;\n\n   %end; /* Both datasets are CAS tables. */\n\n/* If either input or output table is not a CAS table, we use proc surveyselect for sampling. */\n   %else %do;\n   %put One of the tables is not a CAS table.;\n\n   %if (&_STRATA_VAR_COUNT. ne 0) \n      %then %do;\n      %put Stratified sampling is reqested. ;\n\n/* Stratified sampling requires sorted dataset. */\nproc sort data = &INPUTTABLE1. out = WORK._TMP_SAMPLE_;\n   by &_STRATA_VAR_1_NAME. ;\nrun;\n\n      %end;\n      %else %do;\n\n/* Let's create an input dataset with the same name as in statified sampling just to \nkeep the surveyselect code simple. */\ndata WORK._TMP_SAMPLE_;\n   set &INPUTTABLE1.;\nrun;\n\n      %end;\n\nproc surveyselect data = WORK._TMP_SAMPLE_\n   out = &OUTPUTTABLE1.\n   method = srs\n   rate = %sysevalf(&_SAMPLE_PCT./100)\n   seed = &_SEED.;\n   %if (&_STRATA_VAR_COUNT. ne 0) \n/* Stratified sampling code for surveyselect */\n      %then %do;\n   strata &_STRATA_VAR_1_NAME. notsorted;\n      %end;\nrun;\n\nproc datasets library = WORK nodetails nolist;\n   delete _TMP_SAMPLE_;\nquit;\n\n   %end; /*  One of the tables is not a CAS table.*/\n\n%mend;\n\noptions mprint;\n%_random_sampling_;"}}